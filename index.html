<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Nivel 1 - Perdona a tu Princesa</title>

<style>
body{
  margin:0;
  overflow:hidden;
  background:#5c94fc;
  font-family:monospace;
}

#game{
  position:relative;
  width:100vw;
  height:100vh;
  overflow:hidden;
}

/* Piso ladrillo pixel */
.ground{
  position:absolute;
  bottom:0;
  width:5000px;
  height:100px;
  background:
  repeating-linear-gradient(
    90deg,
    #b5522d 0px,
    #b5522d 40px,
    #8c3f1f 40px,
    #8c3f1f 42px
  ),
  repeating-linear-gradient(
    0deg,
    #b5522d 0px,
    #b5522d 40px,
    #8c3f1f 40px,
    #8c3f1f 42px
  );
}

/* Personaje pixel */
.player{
  position:absolute;
  width:40px;
  height:40px;
  background:#ffcc99;
  bottom:100px;
  left:100px;
  box-shadow:
    0 0 0 4px #000 inset;
}

/* Enemigos pixel */
.enemy{
  position:absolute;
  width:40px;
  height:40px;
  bottom:100px;
  background:#8b0000;
  box-shadow:0 0 0 4px #000 inset;
}

/* Dragón grande */
.dragon{
  position:absolute;
  width:80px;
  height:80px;
  bottom:100px;
  background:#550000;
  box-shadow:0 0 0 6px #000 inset;
}

/* Meta */
.goal{
  position:absolute;
  width:20px;
  height:120px;
  bottom:100px;
  background:yellow;
}

/* Nubes pixel */
.cloud{
  position:absolute;
  width:120px;
  height:40px;
  background:white;
  image-rendering:pixelated;
}

/* Overlay */
#overlay{
  position:absolute;
  width:100%;
  height:100%;
  background:rgba(0,0,0,0.8);
  color:white;
  display:flex;
  justify-content:center;
  align-items:center;
  flex-direction:column;
  font-size:30px;
  text-align:center;
  display:none;
}
</style>
</head>

<body>

<div id="game">
  <div class="ground"></div>
  <div class="player" id="player"></div>

  <div class="enemy" style="left:600px;"></div>
  <div class="enemy" style="left:1100px;"></div>
  <div class="enemy" style="left:1700px;"></div>

  <div class="dragon" style="left:2400px;"></div>
  <div class="goal" style="left:3000px;"></div>

  <div class="cloud" style="top:80px; left:200px;"></div>
  <div class="cloud" style="top:150px; left:600px;"></div>

  <div id="overlay"></div>
</div>

<script>
const player = document.getElementById("player");
const overlay = document.getElementById("overlay");
const ground = document.querySelector(".ground");

let position = 100;
let velocityY = 0;
let gravity = 1;
let jumping = false;
let lives = 3;
let camera = 0;

document.addEventListener("keydown", e=>{
  if(e.key==="ArrowRight") position += 15;
  if(e.key==="ArrowLeft") position -= 15;
  if(e.key===" " && !jumping){
    velocityY = -18;
    jumping = true;
  }
});

function gameLoop(){
  velocityY += gravity;
  let bottom = parseInt(player.style.bottom||100);
  bottom -= velocityY;

  if(bottom <= 100){
    bottom = 100;
    velocityY = 0;
    jumping = false;
  }

  player.style.bottom = bottom + "px";
  player.style.left = position + "px";

  camera = position - 200;
  document.getElementById("game").style.transform = `translateX(${-camera}px)`;

  checkCollisions();
  requestAnimationFrame(gameLoop);
}

function checkCollisions(){
  const enemies = document.querySelectorAll(".enemy, .dragon");
  const goal = document.querySelector(".goal");

  enemies.forEach(enemy=>{
    if(isColliding(player, enemy)){
      loseLife();
    }
  });

  if(isColliding(player, goal)){
    showMessage("NIVEL 1 COMPLETADO<br>¿AHORA SÍ VAS A PERDONAR A TU PRINCESA?");
  }
}

function isColliding(a,b){
  const rect1 = a.getBoundingClientRect();
  const rect2 = b.getBoundingClientRect();
  return !(
    rect1.top > rect2.bottom ||
    rect1.bottom < rect2.top ||
    rect1.right < rect2.left ||
    rect1.left > rect2.right
  );
}

function loseLife(){
  lives--;
  if(lives > 0){
    showMessage("JAJAJA TE TOCA OTRA VEZ POR BOBIS<br><br>NIVEL 1<br>VIDAS: "+lives+"<br>PREPÁRATE PARA JUGAR, GROSERO", true);
  } else {
    showMessage("GAME OVER PAPITO,<br>YA PERDÓNAME");
  }
}

function showMessage(text, restart=false){
  overlay.innerHTML = text;
  overlay.style.display = "flex";

  setTimeout(()=>{
    overlay.style.display="none";
    if(restart){
      position = 100;
      player.style.left="100px";
    }
  },2500);
}

gameLoop();
</script>

</body>
</html>
