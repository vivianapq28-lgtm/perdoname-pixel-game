<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Mi Juego</title>

<style>
body {
    margin: 0;
    overflow: hidden;
}

canvas {
    display: block;
    margin: auto;
}
</style>
</head>

<body>
<canvas id="game"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

canvas.width = 1000;
canvas.height = 400;

let level = 1;
let gameOver = false;

// JUGADOR
let player = {
    x: 100,
    y: 300,
    width: 40,
    height: 40,
    dy: 0,
    gravity: 0.6,
    jumpPower: -12,
    grounded: false
};

let ground = {
    y: 350,
    height: 50
};

// DRAGÓN NIVEL 1
let dragon = {
    x: 850,
    y: 270,
    width: 80,
    height: 80
};

let fireballs = [];
let fireTimer = 0;

// NUBES
let clouds = [
    {x: 100, y: 60},
    {x: 400, y: 90},
    {x: 700, y: 70}
];

let keys = {};
document.addEventListener("keydown", e => keys[e.key] = true);
document.addEventListener("keyup", e => keys[e.key] = false);

function resetPlayer() {
    player.x = 100;
    player.y = 300;
    player.dy = 0;
}

function update() {

    if (gameOver) return;

    if (keys["ArrowRight"]) player.x += 5;
    if (keys["ArrowLeft"]) player.x -= 5;

    if (keys[" "] && player.grounded) {
        player.dy = player.jumpPower;
        player.grounded = false;
    }

    player.dy += player.gravity;
    player.y += player.dy;

    if (player.y + player.height >= ground.y) {
        player.y = ground.y - player.height;
        player.dy = 0;
        player.grounded = true;
    }

    // Movimiento nubes
    clouds.forEach(c => {
        c.x += 0.3;
        if (c.x > canvas.width + 100) c.x = -100;
    });

    if (level === 1) {

        fireTimer++;
        if (fireTimer > 90) {
            fireballs.push({
                x: dragon.x,
                y: dragon.y + 40,
                size: 18,
                speed: 6
            });
            fireTimer = 0;
        }

        fireballs.forEach(f => {
            f.x -= f.speed;

            if (
                player.x < f.x + f.size &&
                player.x + player.width > f.x &&
                player.y < f.y + f.size &&
                player.y + player.height > f.y
            ) {
                gameOver = true;
            }
        });

        // Si pasa el dragón → nivel 2
        if (player.x > dragon.x + 100) {
            level = 2;
            resetPlayer();
        }
    }
}

function drawCloud(x, y) {
    ctx.fillStyle = "white";
    ctx.beginPath();
    ctx.arc(x, y, 20, 0, Math.PI * 2);
    ctx.arc(x + 25, y, 25, 0, Math.PI * 2);
    ctx.arc(x + 50, y, 20, 0, Math.PI * 2);
    ctx.fill();
}

function drawBricks() {
    for (let i = 0; i < canvas.width; i += 40) {
        ctx.fillStyle = "#b55239";
        ctx.fillRect(i, ground.y, 38, 48);
        ctx.strokeStyle = "#7a2d1d";
        ctx.strokeRect(i, ground.y, 38, 48);
    }
}

function drawDragon() {
    ctx.fillStyle = "#5e2ca5";
    ctx.fillRect(dragon.x, dragon.y, dragon.width, dragon.height);

    ctx.fillStyle = "yellow";
    ctx.fillRect(dragon.x + 50, dragon.y + 20, 12, 12);
}

function drawFireball(f) {
    ctx.fillStyle = "orange";
    ctx.beginPath();
    ctx.arc(f.x, f.y, f.size, 0, Math.PI * 2);
    ctx.fill();

    ctx.fillStyle = "red";
    ctx.beginPath();
    ctx.arc(f.x, f.y, f.size / 2, 0, Math.PI * 2);
    ctx.fill();
}

function draw() {

    // Cielo azul bebé
    ctx.fillStyle = "#bde7ff";
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    // Nubes
    clouds.forEach(c => drawCloud(c.x, c.y));

    drawBricks();

    if (level === 1) {
        drawDragon();
        fireballs.forEach(drawFireball);
    }

    if (level === 2) {
        ctx.fillStyle = "black";
        ctx.font = "50px Arial";
        ctx.fillText("NIVEL 2", 400, 200);
    }

    ctx.fillStyle = "#ff3b3b";
    ctx.fillRect(player.x, player.y, player.width, player.height);

    if (gameOver) {
        ctx.fillStyle = "black";
        ctx.font = "bold 40px Arial";
        ctx.fillText("GAME OVER", 350, 180);
        ctx.font = "25px Arial";
        ctx.fillText("Por no perdonar a tu princesa...", 330, 220);
    }
}

function loop() {
    update();
    draw();
    requestAnimationFrame(loop);
}

loop();
</script>

</body>
</html>
