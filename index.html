<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Mi Juego</title>
<style>
body { margin:0; overflow:hidden; }
canvas { display:block; margin:auto; }
</style>
</head>
<body>
<canvas id="game"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

canvas.width = 1000;
canvas.height = 400;

let worldWidth = 3000;
let cameraX = 0;
let gameOver = false;
let levelComplete = false;

// JUGADOR
let player = {
    x: 100,
    y: 300,
    width: 40,
    height: 40,
    dy: 0,
    gravity: 0.8,
    jumpPower: -14,
    grounded: false,
    speed: 4
};

let ground = { y: 350, height: 50 };

// DRAGÓN FINAL
let finalDragon = {
    x: 2600,
    y: 270,
    width: 90,
    height: 90
};

// MINI DRAGONES
let miniDragons = [
    {x:600, y:310, width:40, height:40},
    {x:1100, y:310, width:40, height:40},
    {x:1600, y:310, width:40, height:40},
    {x:2100, y:310, width:40, height:40}
];

// META
let finishLine = 2850;

let keys = {};
document.addEventListener("keydown", e => keys[e.key] = true);
document.addEventListener("keyup", e => keys[e.key] = false);

function resetGame(){
    player.x = 100;
    player.y = 300;
    player.dy = 0;
    cameraX = 0;
    gameOver = false;
}

function collision(a,b){
    return (
        a.x < b.x + b.width &&
        a.x + a.width > b.x &&
        a.y < b.y + b.height &&
        a.y + a.height > b.y
    );
}

function update(){

    if(gameOver || levelComplete) return;

    if(keys["ArrowRight"]) player.x += player.speed;
    if(keys["ArrowLeft"]) player.x -= player.speed;

    if(keys[" "] && player.grounded){
        player.dy = player.jumpPower;
        player.grounded = false;
    }

    player.dy += player.gravity;
    player.y += player.dy;

    if(player.y + player.height >= ground.y){
        player.y = ground.y - player.height;
        player.dy = 0;
        player.grounded = true;
    }

    // Cámara sigue al jugador
    cameraX = player.x - 300;
    if(cameraX < 0) cameraX = 0;
    if(cameraX > worldWidth - canvas.width)
        cameraX = worldWidth - canvas.width;

    // Colisión mini dragones
    miniDragons.forEach(d=>{
        if(collision(player,d)){
            gameOver = true;
        }
    });

    // Colisión dragón final
    if(collision(player,finalDragon)){
        gameOver = true;
    }

    // Línea de meta
    if(player.x > finishLine){
        levelComplete = true;
    }
}

function drawCloud(x,y){
    ctx.fillStyle="white";
    ctx.beginPath();
    ctx.arc(x,y,20,0,Math.PI*2);
    ctx.arc(x+25,y,25,0,Math.PI*2);
    ctx.arc(x+50,y,20,0,Math.PI*2);
    ctx.fill();
}

function drawBricks(){
    for(let i=0;i<worldWidth;i+=40){
        ctx.fillStyle="#b55239";
        ctx.fillRect(i-cameraX,ground.y,38,48);
        ctx.strokeStyle="#7a2d1d";
        ctx.strokeRect(i-cameraX,ground.y,38,48);
    }
}

function drawDragon(d,color){
    ctx.fillStyle=color;
    ctx.fillRect(d.x-cameraX,d.y,d.width,d.height);
    ctx.fillStyle="yellow";
    ctx.fillRect(d.x-cameraX+d.width-15,d.y+10,10,10);
}

function draw(){

    // Cielo azul bebé
    ctx.fillStyle="#bde7ff";
    ctx.fillRect(0,0,canvas.width,canvas.height);

    // Nubes (efecto desplazamiento más lento)
    drawCloud(200-cameraX*0.3,70);
    drawCloud(600-cameraX*0.3,90);
    drawCloud(1000-cameraX*0.3,60);
    drawCloud(1500-cameraX*0.3,80);

    drawBricks();

    // Mini dragones
    miniDragons.forEach(d=>drawDragon(d,"#cc3333"));

    // Dragón final
    drawDragon(finalDragon,"#5e2ca5");

    // Línea meta
    ctx.fillStyle="black";
    ctx.fillRect(finishLine-cameraX,250,10,100);

    // Jugador
    ctx.fillStyle="#ff3b3b";
    ctx.fillRect(player.x-cameraX,player.y,player.width,player.height);

    if(gameOver){
        ctx.fillStyle="black";
        ctx.font="bold 45px Arial";
        ctx.fillText("GAME OVER",350,170);
        ctx.font="25px Arial";
        ctx.fillText("Por no perdonar a tu princesa.",300,210);
    }

    if(levelComplete){
        ctx.fillStyle="black";
        ctx.font="bold 50px Arial";
        ctx.fillText("NIVEL COMPLETADO",280,200);
    }
}

function loop(){
    update();
    draw();
    requestAnimationFrame(loop);
}

loop();
</script>
</body>
</html>
