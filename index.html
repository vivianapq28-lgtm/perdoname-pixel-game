<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Perdona a tu Princesa</title>

<style>
body{
  margin:0;
  overflow:hidden;
  background:#79a9ff; /* Azul intermedio estilo Mario */
  font-family:monospace;
}

#world{
  position:absolute;
  height:100%;
  width:6000px;
}

.ground{
  position:absolute;
  bottom:0;
  width:6000px;
  height:100px;
  background:
  repeating-linear-gradient(
    0deg,
    #c06030 0px,
    #c06030 38px,
    black 38px,
    black 40px
  ),
  repeating-linear-gradient(
    90deg,
    #c06030 0px,
    #c06030 78px,
    black 78px,
    black 80px
  );
}

/* Jugador */
.player{
  position:absolute;
  width:40px;
  height:40px;
  background:#ffcc99;
  bottom:100px;
  left:100px;
  border:4px solid black;
}

/* Enemigos */
.enemy{
  position:absolute;
  width:40px;
  height:40px;
  background:#8b0000;
  border:4px solid black;
  bottom:100px;
}

/* DragÃ³n */
.dragon{
  position:absolute;
  width:80px;
  height:80px;
  background:#550000;
  border:6px solid black;
  bottom:100px;
}

/* Meta */
.goal{
  position:absolute;
  width:20px;
  height:120px;
  background:yellow;
  border:4px solid black;
  bottom:100px;
}

/* Overlay */
#overlay{
  position:fixed;
  width:100%;
  height:100%;
  background:black;
  color:white;
  display:none;
  justify-content:center;
  align-items:center;
  flex-direction:column;
  font-size:30px;
  text-align:center;
  z-index:1000;
}

/* Fuegos artificiales */
.firework{
  position:absolute;
  width:6px;
  height:6px;
  background:yellow;
  border-radius:50%;
}
</style>
</head>

<body>

<div id="overlay"></div>

<div id="camera">
  <div id="world">
    <div class="ground"></div>
    <div class="player" id="player"></div>

    <div class="enemy" style="left:800px;"></div>
    <div class="enemy" style="left:1500px;"></div>
    <div class="enemy" style="left:2200px;"></div>

    <div class="dragon" style="left:3200px;"></div>
    <div class="goal" style="left:4500px;"></div>
  </div>
</div>

<script>
const player = document.getElementById("player");
const world = document.getElementById("world");
const overlay = document.getElementById("overlay");
const enemies = document.querySelectorAll(".enemy, .dragon");
const goal = document.querySelector(".goal");

let position = 100;
let velocityY = 0;
let gravity = 1;
let jumping = false;
let lives = 3;
let deaths = 0;
let cameraX = 0;
let level = 1;
let levelPerfect = true;

document.addEventListener("keydown", e=>{
  if(e.key==="ArrowRight") position += 15;
  if(e.key==="ArrowLeft") position -= 15;
  if(e.key===" " && !jumping){
    velocityY = -18;
    jumping = true;
  }
});

function loop(){
  velocityY += gravity;
  let bottom = parseInt(player.style.bottom||100);
  bottom -= velocityY;

  if(bottom <= 100){
    bottom = 100;
    velocityY = 0;
    jumping = false;
  }

  player.style.bottom = bottom+"px";
  player.style.left = position+"px";

  cameraX = position - 200;
  document.body.style.transform = `translateX(${-cameraX}px)`;

  moveEnemies();
  checkCollision();

  requestAnimationFrame(loop);
}

function moveEnemies(){
  enemies.forEach(enemy=>{
    let enemyX = parseInt(enemy.style.left);
    if(enemyX > position){
      enemy.style.left = (enemyX - 2) + "px";
    } else {
      enemy.style.left = (enemyX + 2) + "px";
    }
  });
}

function checkCollision(){
  enemies.forEach(enemy=>{
    if(isColliding(player, enemy)){
      loseLife();
    }
  });

  if(isColliding(player, goal)){
    completeLevel();
  }
}

function isColliding(a,b){
  const r1 = a.getBoundingClientRect();
  const r2 = b.getBoundingClientRect();
  return !(
    r1.top > r2.bottom ||
    r1.bottom < r2.top ||
    r1.right < r2.left ||
    r1.left > r2.right
  );
}

function loseLife(){
  if(lives <= 0) return;

  lives--;
  levelPerfect = false;

  overlay.innerHTML = "JAJAJA TE TOCA OTRA VEZ POR BOBIS<br><br>NIVEL "+level+"<br>VIDAS: "+lives+"<br>PREPÃRATE PARA JUGAR, GROSERO";
  overlay.style.display="flex";

  setTimeout(()=>{
    overlay.style.display="none";
    resetPosition();
  },2500);

  if(lives === 0){
    setTimeout(()=>{
      overlay.innerHTML="GAME OVER PAPITO,<br>YA PERDÃ“NAME";
      overlay.style.display="flex";
    },2600);
  }
}

function resetPosition(){
  position = 100;
  player.style.left="100px";
}

function completeLevel(){
  if(levelPerfect){
    fireworks();
  }

  overlay.innerHTML="Â¿Muy feliz? Ahora te toca el otro ðŸ˜¡";
  overlay.style.display="flex";

  level++;
  lives=3;
  levelPerfect=true;
}

function fireworks(){
  for(let i=0;i<80;i++){
    let f=document.createElement("div");
    f.className="firework";
    f.style.left=Math.random()*window.innerWidth+"px";
    f.style.top=Math.random()*300+"px";
    document.body.appendChild(f);
    setTimeout(()=>f.remove(),1000);
  }
}

loop();
</script>

</body>
</html>
