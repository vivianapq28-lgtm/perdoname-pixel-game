<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Perdona a tu Princesa</title>
<style>
body{
  margin:0;
  overflow:hidden;
  background:#8bb7ff;
  font-family:monospace;
}

#camera{
  position:relative;
  width:100vw;
  height:100vh;
  overflow:hidden;
}

#world{
  position:absolute;
  height:100%;
  width:7000px;
}

.ground{
  position:absolute;
  bottom:0;
  width:7000px;
  height:100px;
  background:
    repeating-linear-gradient(
      90deg,
      #c06030 0px,
      #c06030 60px,
      black 60px,
      black 64px
    ),
    repeating-linear-gradient(
      0deg,
      #c06030 0px,
      #c06030 30px,
      black 30px,
      black 34px
    );
}

.player{
  position:absolute;
  width:40px;
  height:40px;
  background:#ffcc99;
  border:4px solid black;
  bottom:100px;
  left:150px;
}

.enemy{
  position:absolute;
  width:30px;  /* m치s delgado */
  height:30px;
  background:#8b0000;
  border:3px solid black;
  bottom:100px;
}

.dragon{
  position:absolute;
  width:60px; /* m치s delgado */
  height:60px;
  background:#550000;
  border:4px solid black;
  bottom:100px;
}

.goal{
  position:absolute;
  width:20px;
  height:120px;
  background:yellow;
  border:4px solid black;
  bottom:100px;
}

.cloud{
  position:absolute;
  width:80px;
  height:50px;
  background:white;
  border-radius:50%;
  opacity:0.7;
}

#overlay{
  position:fixed;
  width:100%;
  height:100%;
  background:black;
  color:white;
  display:none;
  justify-content:center;
  align-items:center;
  flex-direction:column;
  font-size:30px;
  text-align:center;
  z-index:999;
}

.firework{
  position:absolute;
  width:6px;
  height:6px;
  border-radius:50%;
}
</style>
</head>
<body>

<div id="overlay"></div>

<div id="camera">
  <div id="world">
    <div class="ground"></div>
    <div class="player" id="player"></div>

    <div class="enemy" style="left:1000px;"></div>
    <div class="enemy" style="left:1800px;"></div>
    <div class="enemy" style="left:2600px;"></div>

    <div class="dragon" style="left:3800px;"></div>
    <div class="goal" style="left:6000px;"></div>

    <!-- Nubes -->
    <div class="cloud" style="left:400px; top:50px;"></div>
    <div class="cloud" style="left:1200px; top:80px;"></div>
    <div class="cloud" style="left:2200px; top:30px;"></div>
    <div class="cloud" style="left:3500px; top:70px;"></div>
    <div class="cloud" style="left:5000px; top:40px;"></div>
  </div>
</div>

<script>
const player = document.getElementById("player");
const world = document.getElementById("world");
const overlay = document.getElementById("overlay");
const enemies = document.querySelectorAll(".enemy");
const dragon = document.querySelector(".dragon");
const goal = document.querySelector(".goal");
const clouds = document.querySelectorAll(".cloud");

let position = 150;
let velocityY = 0;
let gravity = 1;
let jumping = false;
let lives = 3;
let level = 1;
let perfectLevel = true;

// Guardar posiciones iniciales
const enemyPositions = Array.from(enemies).map(e => parseInt(e.style.left));
const dragonInitialX = parseInt(dragon.style.left);
let dragonDirection = 1;

document.addEventListener("keydown", e=>{
  if(e.key==="ArrowRight") position += 1.5; // m치s ligero
  if(e.key==="ArrowLeft") position -= 1.5;
  if(position < 0) position = 0;
  if(e.key===" " && !jumping){
    velocityY = -15; // salto un poco m치s ligero
    jumping = true;
  }
});

function gameLoop(){
  // SALTO
  velocityY += gravity;
  let bottom = parseInt(player.style.bottom||100);
  bottom -= velocityY;
  if(bottom <= 100){
    bottom = 100;
    velocityY = 0;
    jumping = false;
  }
  player.style.bottom = bottom+"px";
  player.style.left = position+"px";

  // C츼MARA
  let cameraX = position - 300;
  if(cameraX < 0) cameraX = 0;
  world.style.transform = `translateX(${-cameraX}px)`;

  moveEnemies();
  moveDragon();
  moveClouds();
  checkCollision();

  requestAnimationFrame(gameLoop);
}

function moveEnemies(){
  enemies.forEach(enemy=>{
    let enemyX = parseInt(enemy.style.left);
    if(enemyX > position){
      enemy.style.left = (enemyX - 1.5)+"px";
    } else {
      enemy.style.left = (enemyX + 1.5)+"px";
    }
  });
}

function moveDragon(){
  let dragonX = parseInt(dragon.style.left);
  dragonX += dragonDirection * 1;
  if(dragonX > dragonInitialX + 200 || dragonX < dragonInitialX - 200){
    dragonDirection *= -1;
  }
  dragon.style.left = dragonX + "px";
}

function moveClouds(){
  clouds.forEach(cloud=>{
    let left = parseFloat(cloud.style.left);
    left -= 0.3; // movimiento lento
    if(left < -100) left = 7000; // reaparece a la derecha
    cloud.style.left = left+"px";
  });
}

function checkCollision(){
  enemies.forEach(enemy=>{
    if(isColliding(player, enemy)) loseLife();
  });
  if(isColliding(player, dragon)) loseLife();
  if(isColliding(player, goal)) winLevel();
}

function isColliding(a,b){
  const r1 = a.getBoundingClientRect();
  const r2 = b.getBoundingClientRect();
  return !(r1.top > r2.bottom || r1.bottom < r2.top || r1.right < r2.left || r1.left > r2.right);
}

function loseLife(){
  if(lives <= 0) return;

  lives--;
  perfectLevel = false;
  overlay.innerHTML =
    `JAJAJA TE TOCA OTRA VEZ POR BOBIS<br><br>NIVEL ${level}<br>VIDAS: ${lives}<br>PREP츼RATE PARA JUGAR, GROSERO`;
  overlay.style.display="flex";
  resetLevel();

  if(lives === 0){
    setTimeout(()=>overlay.innerHTML="GAME OVER PAPITO,<br>YA PERD칍NAME",2000);
  } else {
    setTimeout(()=>overlay.style.display="none",2000);
  }
}

function resetLevel(){
  position = 150;
  player.style.left="150px";
  // Reset enemigos
  enemies.forEach((e,i)=> e.style.left = enemyPositions[i]+"px");
  dragon.style.left = dragonInitialX+"px";
}

function winLevel(){
  overlay.style.display="flex";
  if(perfectLevel) fireworks();
  overlay.innerHTML = perfectLevel ?
    `춰Nivel Perfecto! 游땙<br>Prep치rate para el siguiente` :
    `Nivel completado 游땚<br>Pero podr칤as mejorar`;

  level++;
  lives=3;
  perfectLevel=true;
  setTimeout(()=>overlay.style.display="none",2000);
}

function fireworks(){
  const colors = ["yellow","red","orange","white","blue"];
  for(let i=0;i<50;i++){
    let f = document.createElement("div");
    f.className="firework";
    f.style.background = colors[Math.floor(Math.random()*colors.length)];
    f.style.left = Math.random()*window.innerWidth+"px";
    f.style.top = Math.random()*200+"px";
    document.body.appendChild(f);

    let top = parseFloat(f.style.top);
    let left = parseFloat(f.style.left);
    let angle = Math.random()*2*Math.PI;
    let speed = 2 + Math.random()*3;

    let interval = setInterval(()=>{
      top -= Math.cos(angle)*speed;
      left += Math.sin(angle)*speed;
      f.style.top = top+"px";
      f.style.left = left+"px";
    },16);

    setTimeout(()=>{
      clearInterval(interval);
      f.remove();
    },1000);
  }
}

gameLoop();
</script>
</body>
</html>
