<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>El Rescate</title>
<style>
body {
    margin: 0;
    overflow: hidden;
    background: black;
}
canvas {
    display: block;
    margin: auto;
    background: #bde0fe;
}
#levelScreen {
    position: absolute;
    width: 100%;
    height: 100%;
    background: black;
    color: white;
    display: flex;
    justify-content: center;
    align-items: center;
    flex-direction: column;
    font-family: Arial;
}
#levelScreen h1 {
    font-size: 60px;
    margin: 0;
}
#levelScreen p {
    font-size: 22px;
}
</style>
</head>
<body>

<div id="levelScreen">
    <h1 id="levelTitle">PrepÃ¡rate para jugar, grosero ðŸ˜¡</h1>
</div>

<canvas id="gameCanvas" width="900" height="500"></canvas>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");
const levelScreen = document.getElementById("levelScreen");
const levelTitle = document.getElementById("levelTitle");

let level = 1;
let gravity = 0.8;
let gameSpeed = 4;
let obstacles = [];
let clouds = [];
let floorOffset = 0;
let distance = 0;
let levelLength = 4000;
let gameOver = false;
let gameStarted = false;
let levelTimer = 0;
let showLevelDuration = 120;

const player = {
    x: 100,
    y: 350,
    width: 40,
    height: 50,
    dy: 0,
    jumping: false
};

function prepareLevel() {
    levelScreen.style.display = "flex";
    levelTitle.innerText = "PrepÃ¡rate para jugar, grosero ðŸ˜¡";
    levelTimer = 0;
    gameStarted = false;

    obstacles = [];
    distance = 0;
    gameSpeed = 3 + level * 1.2;
    levelLength = 4000 + level * 2000;
}

function createClouds() {
    clouds = [];
    for (let i = 0; i < 6; i++) {
        clouds.push({
            x: Math.random() * canvas.width,
            y: Math.random() * 150,
            size: 40 + Math.random() * 40
        });
    }
}

function drawClouds() {
    ctx.fillStyle = "white";
    clouds.forEach(cloud => {
        ctx.beginPath();
        ctx.arc(cloud.x, cloud.y, cloud.size/2, 0, Math.PI*2);
        ctx.fill();
        cloud.x -= gameSpeed * 0.3;
        if (cloud.x < -50) cloud.x = canvas.width + 50;
    });
}

function drawFloor() {
    const brickWidth = 60;
    const brickHeight = 30;

    floorOffset -= gameSpeed;
    if (floorOffset <= -brickWidth) floorOffset = 0;

    for (let x = floorOffset; x < canvas.width; x += brickWidth) {
        for (let y = 400; y < canvas.height; y += brickHeight) {
            ctx.fillStyle = "#b5651d";
            ctx.fillRect(x, y, brickWidth - 3, brickHeight - 3);
        }
    }
}

function createObstacle() {
    const size = 30 + Math.random() * 20;
    obstacles.push({
        x: canvas.width,
        y: 400 - size,
        width: size,
        height: size
    });
}

function drawObstacles() {
    ctx.fillStyle = "darkred";
    obstacles.forEach((obs, index) => {
        obs.x -= gameSpeed;
        ctx.fillRect(obs.x, obs.y, obs.width, obs.height);

        if (collision(player, obs)) endGame();

        if (obs.x + obs.width < 0) obstacles.splice(index, 1);
    });
}

function drawPlayer() {
    ctx.fillStyle = "blue";
    ctx.fillRect(player.x, player.y, player.width, player.height);
}

function collision(a, b) {
    return a.x < b.x + b.width &&
           a.x + a.width > b.x &&
           a.y < b.y + b.height &&
           a.y + a.height > b.y;
}

function update() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    if (!gameStarted) {
        levelTimer++;
        if (levelTimer >= showLevelDuration) {
            levelScreen.style.display = "none";
            gameStarted = true;
        }
    } else if (!gameOver) {

        drawClouds();
        drawFloor();

        player.dy += gravity;
        player.y += player.dy;

        if (player.y > 350) {
            player.y = 350;
            player.jumping = false;
        }

        drawPlayer();
        drawObstacles();

        if (Math.random() < 0.02 + level * 0.01) createObstacle();

        distance += gameSpeed;

        if (distance > levelLength) {
            level++;
            if (level > 3) {
                winGame();
            } else {
                prepareLevel();
            }
        }
    }

    requestAnimationFrame(update);
}

function endGame() {
    gameOver = true;
    ctx.fillStyle = "black";
    ctx.fillRect(0,0,canvas.width,canvas.height);
    ctx.fillStyle = "red";
    ctx.font = "50px Arial";
    ctx.fillText("GAME OVER", 280, 220);
    ctx.font = "25px Arial";
    ctx.fillText("Por no perdonar a tu princesa", 240, 270);
}

function winGame() {
    ctx.fillStyle = "black";
    ctx.fillRect(0,0,canvas.width,canvas.height);
    ctx.fillStyle = "gold";
    ctx.font = "50px Arial";
    ctx.fillText("LA RECUPERASTE", 260, 220);
}

document.addEventListener("keydown", function(e) {
    if (e.code === "Space" && !player.jumping && gameStarted) {
        player.dy = -15 - level * 2;
        player.jumping = true;
    }
});

createClouds();
prepareLevel();
update();
</script>

</body>
</html>
